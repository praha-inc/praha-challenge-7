# TDD（テスト駆動開発）でコードを書いてみる

## テスト駆動開発とは？
「動作するきれいなコード」を実現するために提唱された開発スタイルのこと。まず正常に動作するコードをコードの綺麗さなどは考慮せずに書いてみる。ここでの「正常に動作する」とは、作成した自動テストを通ることを指す。その後、可読性やパフォーマンスなどを考慮した綺麗なコードに修正していく。
主に以下の2つのルールに従って開発が行われる。
- 自動化されたテストが失敗したときのみ、新しいコードを書く。
- 重複を除去する。

具体的な手順は以下の通り、
1. 対象機能の実装を行うにあたって必要になりそうなテストをTODOリストに書き出しておく。
    - どのテストコードを次に書くべきか？を明確にする。
    - 実装を進める中で生じた疑問点や、追加した方がいいテストケースなどが見つかった場合は随時追加していく。
2. TODOリストから選んだ項目について、テストコードを記述する(テストファースト)。
3. テストを実行する
    - 未実装の機能に対するテストはこの段階で落ちる。
4. 落ちたテストに対して、テストが通るようなプロダクトコードを記述する。
    - この段階では、テストに通ることだけを考える。例えば、メソッドの戻り値をベタ書きで書くことでテストを通す。
    ```
    // テスト対象メソッド：引数の値を足した値を返却する。
    public int addNumber(int a, int b){
        return 10;
    }

    // テストコード
    @Test
    public void testAddNumber(){
        int a = 4;
        int b = 6;
        assertEquals(10, addNumber(a, b));
    } 
    ```
5. テストが通ることを確認したら、ロジックや変数を本物のロジックに置き換えていく。（動作するコードの実現）
6. テスト結果が変わらないことを確認しながら、コードの重複排除や、可読性向上のためにリファクタリングを行う。（きれいなコードの実現）

## 課題１
> テスト駆動開発のメリットとデメリットを挙げてください
### メリット
- プロダクトコードとテストコードが基本的にセットで存在している前提であるため、各プログラムの品質が保証される。
    - テストがあるからいつでもリファクタリングしやすい。 
- どんな値を返す変数を書けばいいのか？という実装の目的が、テストコードを先に書くことにより明示的になるため、実装が大変な機能であっても小さいゴールから段階的に、動作するコードを仕上げていくことができる。
    - 経験が浅い人でも、品質の保証されたコードを書くことができる。
- テストコードがあって初めて、プロダクトコードを書くため、自然とテスタブルなコードを意識するようになる（凝集度、疎結合、副作用がないかとか…）。
- 開発者の精神が安定する。
    - 書いているコードが確実に動作することを保証しながら開発を進めるので、不具合があるかもという心配が軽減されるためよく眠れるかもしれない。

### デメリット
- 開発に時間がかかる。
    - まず対象機能をTODOリストに書き出して、どんなテストが必要かを洗い出して…と実装までに時間を要することと、テストをとりあえず通してから段階的にコードを仕上げていくために時間を要するという点が慣れるまでは大変そう…。
    - 「どんなテストがあった方がいいか」「これはテストしなくても良さそう…」などの判断はある程度センスとか経験からの感覚？のようなものが必要になってくるのかなと思う。

> TDDにおける以下の用語の意味を説明してください
### 三点測量（三角測量）
テストコードに対して、違う観点の複数のテストを追記することで、テスト対象コードが正しく動作しているかを確実に判定できるようにする。
```
@Test
public void testAdd(){
    assertEquals(4, add(2, 2)); // 2*2=4の可能性もある
    assertEquals(5, add(1, 4)); // これで足し算かどうかがわかる
}
```

### レッド・グリーン・リファクタリング
TDDにおけるプログラミングの作業手順
- レッド
    - 動作しない、コンパイルも通らないテストを書く。
- グリーン
    - 作成したテストを通るような動作するコードを書く。とりあえずテストを通すことが目的。
- リファクタリング
    - テストを通すために書いたコードから重複を排除するなど、きれいなコードになるようにリファクタリングを行う。
この3つのサイクルを回していくことでプロダクトコードを仕上げていく。

### 仮実装
失敗するテストを書いたあと最初に行うプロダクトコードの実装。べた書きの値を返すようにしておいて、とりあえずテストを通す（グリーンのフェーズに該当）。
#### TDD本で説明されている仮実装の有効性
- 心理的効果
    - グリーン（テストをパスしている状態）とレッド（テストに失敗している状態）では、精神状態が異なる。グリーンであれば、自信を持ってリファクタリングを行える。
- スコープ制御
    - 目の前の一つの実例（テスト）をスタートに、プロダクトコードを書いていくことで本質と関係ない問題に気を取られずに作業ができるようになる（目の前の問題に集中できる＝スコープを制御）。

> TDDと似た概念としてBDDが挙げられますが、これらは何が違うのでしょう？提唱者はどのような問題を解決したくてBDDを提案したのでしょう？

### TDDが抱えていた問題
- テスト駆動開発という名前に含まれる「テスト」という言葉や、それにまつわる語彙がTDDの理解を邪魔しているという問題
    - テストという名前がついているが、TDDはテストの手法ではない。「TDDは分析技法であり、設計技法であり、実際には開発のすべてのアクティビティを構造化する技法だ」とKent Beck氏の著書で述べられている。
        - テストという名前が先行しているが故に、テストを先に書けばいい…テストが必要だ…という狭い理解にとどまってしまう。
    - TDDはあくまでも設計・開発技法であるため、「TDDで実装したからバグはゼロである」や「テストエンジニアは不要」という誤った理解になってしまう。
        - TDDにおけるテストは、技術面のテストであり、ビジネス的視点は考慮できない（受け入れ/システムテストはビジネス面のテスト）。そのため、テストとして十分とは言い難い。
    - どこからテストを始めるか？何をテストすればよいか？どの程度テストすればよいうか？でつまづいてしまう。

 TDDの「テスト」という言葉や、それにまつわる語彙が招く誤解を解消するため、「テスト」の代わりに何が相応しいかを議論した結果、TDDは「振る舞い（Behavior）」で駆動されているという考え方が生まれた。
そこで、テストやアサーションといった語彙を別の言葉に置き換えることで先入観による誤解を避けることを図った。

### BDDとTDDの違い
根本的な思想や方針は変わらないが、TDDでの語彙では伝わりにくかった部分を言い換えたり、テストコードのテンプレートを与えた。
例えば、テストを振る舞いの記述に特化させるために、「RSpec」などの専用のフレームワークが作成され、
これにより、自然言語に近い構文でテストコードが記述できるようになった（Jestとか）。
また、TDDでは焦点が当たっていなかったユーザー要求や外部仕様に対して、自動化された受け入れテストやシステムテストを記述することで、
アジャイル開発における「イテレーション」単位でのレッド・グリーン・リファクタリングのサイクルが回せるようにした。
ドメイン特化言語（DSL）を用いてテストを記述できるようなフレームワーク（Cucumberなど）も作成されている。
そのため、開発者と非開発者とのコミュニケーションも促進されるといったビジネス的な視点も含まれることから、
アジャイル開発でTDDを活かすことができる工夫がなされている。

## 参考
- [テスト駆動開発／振る舞い駆動開発を始めるための基礎知識](https://atmarkit.itmedia.co.jp/ait/articles/1403/05/news035_3.html)
- [テスト駆動開発](https://www.amazon.co.jp/%E3%83%86%E3%82%B9%E3%83%88%E9%A7%86%E5%8B%95%E9%96%8B%E7%99%BA-Kent-Beck/dp/4274217884)(書籍)