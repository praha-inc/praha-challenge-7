# データベース設計のアンチパターンを学ぶ5

## 課題１
- NewCustomerが持つ各種業務に対する日時カラムが、業務が発生したタイミングで上書きされてしまうため、過去のデータを遡ることができない。
- callNoteで電話をかけた際に交わした内容について管理しているが、複数回電話をかけた場合、いつ電話をした際に交わした内容なのかまでは管理できない。
- 現時点では、成約していた人が解約した場合を表現するには、closedカラムをfalseに、closedAtをNULLに更新することになる。
  - データ場では、一度も成約をしたことがない人なのか、一度成約をしたことがある人なのか区別がつかない。
  - 事実を正しく記録することができない。
- ひとつのエンティティに対して、各種業務が発生した際にUPDATEしなければならないカラム、UPDATEしなくてもよいカラムが複数混在しているため、エンティティに対する独自の更新ルールが多数発生することになる。
  - 実装が複雑化するため、実装ミスが発生する可能性がある。

## 課題２
[ER図](./ER%E5%9B%B3.md)

- NewCustomerに対するイベントが発生するたびに、各種テーブルに情報を溜めていくことができる。
  - 今までのイベントの履歴の参照が可能。
- 業務を新たに追加する必要があってもNewCustomerにカラムを追加するのではなく、テーブルを新規作成するだけで済むため、既存データに影響を与えづらい。

## 課題３
- 受発注管理システム
  - 発注というイベントのテーブルに対して、注文日時・注文確認日・注文内容更新日・入金日…などの厳密な発注というイベント以外のイベントを管理するカラムを作ってしまう。
- 社員情報の管理システム
  - 社員に対して発生する、部署配属、異動、給与の更新、住所のなどの基本情報の変更などをとりあえず社員テーブルにカラムを作成して管理することにした（さすがに人事管理システムでこんなことないとは思いますが…）。