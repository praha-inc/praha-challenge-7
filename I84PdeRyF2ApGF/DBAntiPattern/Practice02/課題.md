# データベース設計のアンチパターンを学ぶ2

## 課題１
> Postに紐づくTagのidを複数のカラムで管理しています  
上記の設計だと、どのような問題が生じるか説明してください

- 特定のタグを含むPostを検索したい場合、tag1Id〜tag3Idの全てのカラムに対してチェックする必要がある。
  ```
   SELECT * FROM Post WHERE tag1Id = 1 OR tag2Id = 1 OR tag3Id = 1
   ```
- タグを3つ以上紐づけたくなった場合に、Postテーブルにカラムを追加する必要があるため、柔軟性に欠ける。
- タグを設定する際に、tag1Id~tag3Idの中でNULLのカラムを探し、そのカラムに対してUPDATEを行うという段階を踏む必要があり、実装が複雑になる。
- タグが重複して登録されてしまう可能性がある（DB側で制限することができない）。
  ```
    INSERT INTO Post(id, text, tag1Id, tag2Id, tag3Id)
    VALUES (1, ‘タグが重複します’, 1, 1, 1)
  ```
  
## 課題２
> どのようにテーブル設計を見直せばこの問題は解決できるでしょうか？

[ER図](./ER%E5%9B%B3.md)

Postに紐づくTagを管理する中間テーブルを採用。

## 課題３
> どんなサービスを開発している時に上記のようなアンチパターンに陥りそうでしょうか？

- アンチパターン課題1と同様多対多の関係性があるものだと該当する恐れがある
- 履修登録システムで学生が履修している教科を登録・管理するシステム
  - Subject1: 経済学、Subject2：経営学、Subject3：英語…のようにSubejctカラムを分けて管理。
