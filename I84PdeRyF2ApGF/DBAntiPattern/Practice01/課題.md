# データベース設計のアンチパターンを学ぶ１

## 課題１
> tagsカラムの中にカンマ区切りで複数の値を入れている設計を稀に見かけます。
  この設計だとどのような問題が生じるか、説明してみてください。
  
- 特定のタグを持つレコードを検索したい場合、LIKE句による検索が必要になり、前方一致、後方一致などを考慮した条件設定をしなければならないため面倒。
- カンマが入るため、文字列として扱う必要が出てくる。そのため、数値を格納したい場合でも意図しない文字列が格納される恐れがある。
  - 例："1,2,tagA,4,5" ← 文字列が紛れ込んでしまう…
- "tagA"を"タグA"という名前に変更したいとなった場合、tagsカラムにtagAを含むレコード全てに対して置換処理を行う必要が出てくる。また"tagA"というタグ自体を削除したい場合にも同様（削除の場合は、元の値を取得した後、タグ一覧を加工し、更新する必要があり処理が複雑化する）。
- tagsカラムに設定されるタグは、"tagA"や"tagB"という名前しか情報を持っていないため、表現に拡張性がない（例えばtagsテーブルにタグの情報を切り出せば、"tagA"という名前だけでなく作成日やキャプションなどの属性を付与することができる。tagsテーブル内の個々のタグのIDを外部キーとして参照できるようなテーブル構造にできればいい）

## 課題２
> 上記の問題を解決するよう、スキーマ設計を変更してみてください。

[ER図](./ER図Image.png)

PostとTagは多対多の関係性であるため、中間テーブルを採用。
更新・削除が容易になり、個々のタグの情報を変更したい場合でもTagテーブルへのUPDATEだけで、Postテーブルの関連するレコードへ情報を反映できる。

## 課題３
> どんなサービスを開発している時に上記のようなアンチパターンに陥りそうでしょうか？
    
エンティティ間で他対他の関係性があるものだと該当する恐れがある
- 社員情報管理システムで社員の取得資格を管理するケース。
  - ”取得資格：漢検３級、英検４級、ITパスポート”のようにカンマ区切りで管理。