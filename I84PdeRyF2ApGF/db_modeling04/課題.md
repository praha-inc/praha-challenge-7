# 課題１
## リマインダーアプリのDB設計
- ユーザー
  - Slackに登録している他のユーザーに対してリマインダーを設定
  - 自分が設定したリマインダー一覧を確認できる
  - 自分に対して設定されているタスクを一覧で確認できる
- リマインダー
  - 1時間ごとにバッチが動き、配信が必要なリマインダーを指定したSlackユーザーに通知が届く
  - 送信相手（一つのリマインダーに対して複数人設定可）
  - 文面
  - 毎日、◯日おき、毎週◯曜日、毎月◯日の頻度で設定。
- 想定されるチャット送信の流れ…
  - アプリをワークスペースに追加する
    - アクセストークン、チームID等を取得
  - users.list()でワークスペース内のユーザー情報を取得
  - conversations.open()によってユーザーとアプリがやり取りするのチャンネルIDを取得。
  - コマンドが送信されたらテキスト内のメンションからuser_idを取得し、usersテーブル内の
    user_idと照合。どのユーザーに送信するかを割り当てる。
  - 設定された時刻がきたタイミングで、postMessage()にアクセストークン、チャンネルIDと通知するメッセージを渡してチャットを送信する。

## ER図作成
### テーブル概要
- users（ユーザー）
  - ユーザーとして最低限の情報を格納
  - channel_idはアプリがユーザーに通知するチャンネルID
- teams（ワークスペース）
  - ワークスペースの最低限の情報とアプリ追加時のaccess_tokenを保持
  - postMessageでチャットを送信する際にaccess_tokenが必要になる
- team_users
  - どのチームに誰が所属しているかを中間テーブルで表現
- reminders（リマインダー）
  - リマインダーの周期に関しては以下のように管理
  - frequency_pattern
    - 頻度をパターン分けして管理する。現在の仕様だと...
      - 'days' : ◯日おき、毎日
      - 'weekday' : 毎週◯曜日
      - 'month' : 毎月◯日
  - nortification_day_interval
    - 通知する日にち間隔を保持する
  - nortification_weekday
    - 通知する曜日間隔を保持する
  - nortification_date
    - 通知する日付を保持する
  - nortification_time
    - 通知する時間を保持する
    - 現在の仕様だと、どの通知頻度のパターンを選択した場合でも設定する必要がある
  - 通知のパターンよって通知間隔が格納されるカラムを分けた意図としては、通知間隔が日・曜日・月で設定する値に対する
  　意味合いが異なってくるため。一つのカラムに入る値は明確に分かれていた方がパッと見分かりやすいかと…。
  　また、どのカラムにどんな値をINSERTするかが明示的になるのはアプリ実装側も恩恵があるかと思った。
- user_reminders
  - ユーザーとリマインダーの関係性が多対多であると考えられるため、中間テーブルを採用。
  - 一人に複数のリマインダー / 一つのリマインダーに複数のユーザー　を表現
  - statusカラムでは未完了(UNCOMPLETED)、完了(DONE)を管理。
- send_reminder
  - リマインダーが送信された際にINSERTされるテーブル。
  - 送信した履歴をためていく役割と、次回送信する日時を算出するために送信日を格納
- will_send_reminder
  - 誰にどのリマインダーを次にいつ送信するかを保持する
  - リマインダーが送信された際、タスクが終了した際に削除される。タスクがまだ完了していない場合は、前回送信日から次回送信日を算出し、will_send_atに日時を格納する。
  - 次回送信日は、アプリケーション側で計算する必要がある。 

## 物理設計
- 今回はPostgresql(以後ポスグレ)を使用
- ポスグレの日付はTIMESTAMPが基本とのこと
  - MySQLと違って2038年問題を気にしなくても問題ないとのこと
  - そもそもDATETIME型がポスグレには無い
  - TIME ZONEがDEFAULTでは設定されていないため、'WITH TIME ZONE'が必要かも
- SlashCommandで届くメッセージのメンションからuser_idが取得できるため、そのuser_idに対してリマインダーを紐づけていく。
