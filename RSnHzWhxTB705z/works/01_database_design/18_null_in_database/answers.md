# データベースにおけるNULLの扱い

## 課題1
- SELECT NULL = 0;
    - NULL
- NULL = NULL (以下、SELECT部分を省略)
    - NULL
- NULL <> NULL
    - NULL
- NULL AND TRUE
    - NULL
- NULL AND FALSE
    - 0
- NULL OR TRUE
    - 1
- NULL IS NULL
    - 1
- NULL IS NOT NULL
    - 0

## 課題2
### テーブル設計見直し
- er_diagram.puml
  
### NULLが存在することは悪か
- NULLは、できる限りデフォルト値を入れるなど設計時点で十分に考慮し、基本的にNOT NULL制約を付けた上でどうしても制約を付けないほうが良いなら存在しても良いと思うので、NULLの存在が必ずしも悪だとは考えない。
  - 調べるとよく以下のようなSQLと、この結果にageがNULLの人が含まれないといった例が挙げられている。入力フォームで年齢の箇所を必須ではない場合など、たしかにユーザーの年齢は分からないが、こうした場合は -1 などのデフォルト値をいれればNOT NULL制約を付けられる。
    - この例の場合だと、20歳以下の人を抽出するクエリでも検出されてしまうことと、デフォルト値が-1であることをチーム内で共有することが問題といえば問題かもしれない。
      - 前者については、0歳以上という条件を毎回付けなければいけないが、NOT NULL制約のついていないカラムであれば IS NULL を付けなければならないので、そこの手間は同じかも。（O/Rマッパーを使えばすべてのクエリに0歳以上という条件をつけられる場合もある）
      - 後者について、これひとつなら大変ではないが、数多くあるテーブルひとつひとつに対して何がデフォルト値かを把握しておくのは困難だし、ドキュメントはしっかり運用されているとは限らないケースもありそうだし、都度DBを見に行くのは大変ではありそう...。
```sql
SELECT * FROM users WHERE age != 20;
``` 
  - IS NULLやIS NOT NULLはインデックスが参照されないためパフォーマンス悪化の懸念があり、そういった点でもなるべくNOT NULL制約は付けるべき。
  - 「テーブルを分割してでもNULLを除外するべき」という意見があるようだが、必ずしもそこまでする必要はないのではないか。結局JOINして使うことになるケースが多いだろうから、パフォーマンスの悪化の懸念があるし、必要以上に複雑になる可能性があると思う（前述の通り、できる限りNOT NULL制約は付ける方向で設計することが前提）
  

## 課題3
- プロダクトとして、あるいはチームとして、NULLを許容するという方針があったとしたら、デメリットやリスクを受け入れた上でNULLを許容するのか、デフォルト値を設定してNOT NULL制約を付けるのかは、議論の必要があるところ。そこを議論せずになんでもかんでもNOT NULL制約を付けるのは良くない。
- たとえばINTのデフォルト値を0にしている場合、ユーザーが入力した0と、未入力で0になったレコードの判別がつかないため。
  - 「Q. このお店を月に何回利用しますか」「A. 1:0回、2:1回、3:2回、4:3回以上」という回答必須ではない設問があったとして、ユーザーが1を選択した上で0が入ったのか、回答しなかったために0が入ったのかが分からない。この判別は分析の上で重要であるが、それができなくなってしまう。

## 課題4
### Q
- OracleのデータベースではNULLの扱いが独特です。他のDBMSとは異なる点を説明してください。

### A
- SQL標準ではNULLは値ではないが、Oracleでは空の文字列をNULLとして扱う
  - SQL標準では文字列とNULLを連結するとNULLになるが、Oracleでは空文字として扱われるため、NULLにならない
  - 余談：NULLを含む算術式は常にNULLになる

## 参考
- https://mickindex.sakura.ne.jp/database/db_getout_null.html
- https://mickindex.sakura.ne.jp/database/db_3vl.html
- https://scrapbox.io/kawasima/%E3%83%87%E3%83%BC%E3%82%BF%E3%83%99%E3%83%BC%E3%82%B9%E8%A8%AD%E8%A8%88%E3%81%AB%E3%81%8A%E3%81%91%E3%82%8BNULL
- https://docs.oracle.com/cd/E82638_01/sqlrf/Nulls.html#GUID-B0BA4751-9D88-426A-84AD-BCDBD5584071
