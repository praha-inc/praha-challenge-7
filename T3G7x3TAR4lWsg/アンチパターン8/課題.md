課題1

企業Aのために自社の商品管理サービスを新たに作成することになり、商品テーブルを以下のように作成しました


TABLE Product {

productCode: varchar <- これがPK（主キー）

name: varchar

}



ここでproductCodeが挿しているののコードです。例えば「A106=ネジ」とか「F980=ボルト」など、商品が識別できるようになっています
企業Aの担当者に話を聞いたところは現在企業Aが用意している商品カタログにつけられている商品ごと「商品コードを見れば商品を一意に特定できる」とのことでしたので、そのまま商品コードを主キーに使ってみました


> この対応にはどのような問題点が潜んでいるでしょうか？

- 適切なバリエーションをしなければならない

  varcharがキーだとアプリケーション側で適切に正規化しなければ、例えば「Ａ106」（Ａが全角）などを現場で入れてしまっても気づかずそのまま入力されるため、「何故か検索にでてこない」「Ａ106の売上が立ってない」などのリスクがある。


- 変更容易性が下がる

  今後例えば「A106はネジだったが売れない為廃盤とし、『釘』をA106とする」「商品が多くなってきたので全てのコードの後ろにサイズを付ける変更を行う」などのアプリケーションのロジックは預り知らないところでビジネス決定がなされた場合、変更柔軟性がなく、場合によっては影響を受けるアプリケーションのすべてのデータ（例えば在庫管理）を修正しなければならなくなる。


## 課題2

> どのような主キーを設定すれば、この問題は解決できるでしょうか？

基本的には今回の場合シーケンスでもよいので、IDやUUIDテーブルのようなデータの一意性のみを表現し管理するテーブルがあった方がよい。
それ以上に意味があってしまうと、ビジネスロジックとデータの一意管理とが混在してしまいコードの意味が変わった時に厄介になる。

## 課題3

どんなサービスを開発している時に上記のようなアンチパターンに陥りそうでしょうか？最低でも1つは例を考えてみてください

- お客さんが既に現場でエクセルを使って商品管理やそれに基づいた在庫管理、営業管理などをやっていた。
そこでは商品コードがカタログに基づいて今回のように品番で管理されており、さらにその番号に基づいて在庫管理や売上管理がエクセルによって行われていた。
システムを新しく作るにあたって、過去のエクセルデータも生かすことになり、データ量もあり置き換えるのも大変であったため、そのまま問題無いかと思ってテキストベースの商品コードを主キーにした。

- システムを作る時に社員番号が既に社内に存在し、それは一意で今後も変わらないと考えられたため、社員番号を主キーにして社員マスタテーブルを作った。しかしそのうち会社が大きくなり、「部署ごとに社員番号を1から振りなす仕組みにしてほしい」「別途導入したの入館キーと連動するグループウェアの権限の設計の都合上、部長以上に昇進した者は全て1から始まる番号に変わるようにしたい」などの決定が下され、これまで何年にもわたって運用されていた売上管理などの膨大な全データへの変更が生じ、アプリケーションを修正する必要が出てきた。