# 課題
> DBモデリング1から5までの課題で作成したモデルを振り返ってください。もしアンチパターンを見かけた場合は、そのアンチパターンを回避できるように、モデルを修正してください


## DBモデリング1

#### 課題提出UML

https://dbdiagram.io/d/641bd53d296d97641d8a198e

#### 改善案UML

https://dbdiagram.io/d/64b22f3f02bd1c4a5e1d5359

#### ダメな点とその改善策

- 「商品」テーブルに寿司のセットも単品も「単品商品ID」「セット商品ID」というフィールドを作ることで対応している。正規化しづらくまた「配送商品」など全く別のカテゴリが出てきたた時にフィールドを増やすしかないなど柔軟性が無い。

  ⇒ 「商品カテゴリ」として別マスタを切り、例えば「おもちゃ」や「宅配」など全く別の商品が登場しても対応できるようにした。<br>また「商品」を「個別商品」の組み合わせとして管理。中間テーブルにより、「商品」と「個別商品」の組み合わせを管理して数量把握やマスタ整理などにも生かせるように。

- 「さび抜き」「しゃり小」などを「注文詳細」テーブルのフラグで管理している。

  ⇒「オプションマスタ」を作り注文詳細とは中間テーブルで管理する。

- 「注文票」の中のフラグで管理している。支払い履歴としていつどのように払ったか分からない。また支払い周りはビジネス的にも肥大化しそうな部分。
  
  ⇒そもそも今回管理しないか、やるなら別途支払い履歴管理を行う。
  また「支払い済」はフラグではなくステータスで管理し、例えば今後一部入金や返金などにも対応できる柔軟性を持たせる。

## DBモデリング2

#### 課題UML図

https://dbdiagram.io/d/6414245c296d97641d88b5d4

#### 改善案

https://dbdiagram.io/d/64b23f5802bd1c4a5e1dae48

#### ダメな点とその改善策

テーブルの自己参照のparent_idでスレッドを取得している。
今回複雑なSQLを避ける為に「子スレッド全員が親スレッドのIDを持つ」という形にした。直前の親を子が知っていなくても先祖さえ知っていれば「投稿日順」ということは変わらないのでそうするとデータもSQLもかなりシンプルなまま対応出来た。

ただ今回はそれで逃げられたが、システム的な拡張性や柔軟性を考えるなら閉包テーブルモデルを採用した方がいいのかもしれない。


## DBモデリング3

#### 課題UML図

https://dbdiagram.io/d/6439473c6b319470519a97c1

#### 改善案

https://dbdiagram.io/d/64b249dd02bd1c4a5e1de4b1


#### ダメな点とその改善策

経路列挙モデルでクエリをシンプルにしたが、やはりこれも「今はこれで逃げれるけど」感が否めず、ジェイウォークパターンみがある。データの正規化が出来ない、IDの格納が文字列になってしまう、また格納するフィールドの容量に影響をうけてしまう。などのデメリットがある。

⇒ 柔軟性拡張性の面でやはり閉包テーブルモデルを採用


## DBモデリング4

#### 課題UML図

https://dbdiagram.io/d/648406b9722eb77494b8e21a



#### ダメな点とその改善策

Enumになっており柔軟性、拡張性がない。基本変わらない、と思って作ったがそれでもやはり例えばQUARTERLYとかWEEKLYとかMINUTELYとか今後あり得てしまう。カテゴリとして別途切り出すか、「全部ミリ秒にして絶対値として管理する」なども考えられるかもしれない。

⇒ Enumをカテゴリテーブルとして切り出した。またtimestampをMySQLの2038年問題を懸念してpostgresqlのdatetimetz(datetime with timezoneの略称)に変更


#### 改善案

https://dbdiagram.io/d/64b24bca02bd1c4a5e1dee9d


## DBモデリング5

#### 課題UML図
https://dbdiagram.io/d/648e645102bd1c4a5ea75e26


### 改善案
https://dbdiagram.io/d/64b24e2a02bd1c4a5e1dfe56


#### ダメな点とその改善策

特に目立ったものは無いが、課題4と同じくtimestampをMySQLの2038年問題を懸念してpostgresqlのdatetimetz(datetime with timezoneの略称)に変更
