# 課題１（実装）
### 前の課題で立ち上げた MySQL インスタンスの設定を書き換えて、スロークエリログを有効にしてください
```sql
set global slow_query_log=1;
```

### 実行に0.1秒以上かかったクエリをスロークエリログに記録するように設定してください
```sql
set global long_query_time=0.1;
```

### 実行時間0.1秒以下のクエリを3つ実行して、スロークエリログに記録されない事を確認してください
実行するクエリ
```sql
SELECT * FROM employees
SELECT * FROM departments
SELECT * FROM salaries
```

```terminal
// 実行前
# mysqldumpslow -s c /tmp/slow.log

Reading mysql slow query log from /tmp/slow.log
Count: 1  Time=0.00s (0s)  Lock=0.00s (0s)  Rows=0.0 (0), 0users@0hosts
  mysqld, Version: N.N.N (MySQL Community Server (GPL)). started with:

// 実行後
# mysqldumpslow -s c /tmp/slow.log

Reading mysql slow query log from /tmp/slow.log
Count: 1  Time=0.00s (0s)  Lock=0.00s (0s)  Rows=0.0 (0), 0users@0hosts
  mysqld, Version: N.N.N (MySQL Community Server (GPL)). started with:
```
変化なし
ただ、なんで最初からCountが1なんだろう、、

### 実行時間が0.1秒より長いクエリを3つ実行して、スロークエリログに記録される事を確認してください
実行するクエリ
```sql
SELECT * FROM employees CROSS JOIN titles ON titles.emp_no = employees.emp_no ORDER BY employees.hire_date
SELECT * FROM employees CROSS JOIN dept_emp ON dept_emp.emp_no = employees.emp_no ORDER BY employees.hire_date
SELECT * FROM employees CROSS JOIN salaries ON salaries.emp_no = employees.emp_no ORDER BY employees.hire_date
```

```terminal
// 実行前
# mysqldumpslow -s c /tmp/slow.log

Reading mysql slow query log from /tmp/slow.log
Count: 1  Time=0.00s (0s)  Lock=0.00s (0s)  Rows=0.0 (0), 0users@0hosts
  mysqld, Version: N.N.N (MySQL Community Server (GPL)). started with:

// 実行後
# mysqldumpslow -s c /tmp/slow.log

Reading mysql slow query log from /tmp/slow.log
Count: 1  Time=0.14s (0s)  Lock=0.00s (0s)  Rows=200.0 (200), root[root]@[172.17.0.1]
  /* ApplicationName=DBeaver N.N.N - SQLEditor <Script-N.sql> */ SELECT * FROM employees CROSS JOIN dept_emp ON dept_emp.emp_no = employees.emp_no ORDER BY employees.hire_date
  LIMIT N, N

Count: 1  Time=0.00s (0s)  Lock=0.00s (0s)  Rows=0.0 (0), 0users@0hosts
  mysqld, Version: N.N.N (MySQL Community Server (GPL)). started with:
  # Time: N-N-25T22:N:N.825936Z
  # User@Host: root[root] @  [N.N.N.N]  Id:     N
  # Query_time: N.N  Lock_time: N.N Rows_sent: N  Rows_examined: N
  use employees;
  SET timestamp=N;
  /* ApplicationName=DBeaver N.N.N - SQLEditor <Script-N.sql> */ SELECT * FROM employees CROSS JOIN titles ON titles.emp_no = employees.emp_no ORDER BY employees.hire_date
  LIMIT N, N

Count: 1  Time=4.00s (4s)  Lock=0.00s (0s)  Rows=200.0 (200), root[root]@[172.17.0.1]
  /* ApplicationName=DBeaver N.N.N - SQLEditor <Script-N.sql> */ SELECT * FROM employees CROSS JOIN salaries ON salaries.emp_no = employees.emp_no ORDER BY employees.hire_date
  LIMIT N, N
```

### どんなクエリを実行したのかペアと見せ合って、実行時間を比較してみましょう

### 参考サイト
- [スロークエリの確認方法：MySQL編](https://ptune.jp/tech/how-to-check-mysql-slow-query/)

# 課題２（実装）
### mysqldumpslowコマンド
1. 最も頻度高くスロークエリに現れるクエリ
```sql
mysqldumpslow -s c -t 1 /tmp/slow.log
```

2. 実行時間が最も長いクエリ
```sql
mysqldumpslow -s t -t 1 /tmp/slow.log
```

3. ロック時間が最も長いクエリ
```sql
mysqldumpslow -s l -t 1 /tmp/slow.log
```

### pt-query-digestとは
スロークエリログをより詳しく解析するためのツール

### performance_schemaとは
MySQL パフォーマンススキーマは低レベルで MySQL サーバーの実行をモニタリングするための機能。


### 参考サイト
- [6.6.10 mysqldumpslow — Summarize Slow Query Log Files](https://dev.mysql.com/doc/refman/8.0/en/mysqldumpslow.html)
- [mysqldumpslowの使い方](https://qiita.com/SHUN-SURUGA/items/49cc554882c2d11de494)
- [第 27 章 MySQL パフォーマンススキーマ](https://dev.mysql.com/doc/refman/8.0/ja/performance-schema.html)


# 課題３（実装） ~ 6/27までの目標
### 最も頻度高く発生するスロークエリを高速化するために、（可能であれば）インデックスを作成してください
```terminal
# mysqldumpslow -s l -t 1 /tmp/slow.log

Reading mysql slow query log from /tmp/slow.log
Count: 4  Time=0.88s (3s)  Lock=0.00s (0s)  Rows=200.0 (800), root[root]@[172.17.0.1]
  /* ApplicationName=DBeaver N.N.N - SQLEditor <Script-N.sql> */ SELECT * FROM employees CROSS JOIN titles ON titles.emp_no = employees.emp_no ORDER BY employees.hire_date
  LIMIT N, N
```
`emp_no`はすでにインデックスが作成されているので、`employees.hire_date`のインデックスを作成してみる。

```sql
CREATE INDEX idx_hire_date ON employees (hire_date);
```

### 実行時間が最も長いスロークエリを高速化するために、（可能であれば）インデックスを作成してください
```terminal
# mysqldumpslow -s t -t 1 /tmp/slow.log

Reading mysql slow query log from /tmp/slow.log
Count: 1  Time=4.00s (4s)  Lock=0.00s (0s)  Rows=200.0 (200), root[root]@[172.17.0.1]
  /* ApplicationName=DBeaver N.N.N - SQLEditor <Script-N.sql> */ SELECT * FROM employees CROSS JOIN salaries ON salaries.emp_no = employees.emp_no ORDER BY employees.hire_date
```
こっちも同じなので、スキップ


# 課題４（質問）


# 課題5（質問）


# 課題6