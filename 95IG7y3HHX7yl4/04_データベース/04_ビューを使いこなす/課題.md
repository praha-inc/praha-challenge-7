# 課題１（質問）

### 「ビュー」の仕組みを、プログラミング歴1ヶ月のエンジニアにも伝わるよう、わかりやすく説明してください
ビューはデータを持たない仮想テーブルのようなものです。  
ビューは内部にSELECT文を保存しており、ビューからデータを取り出そうとすると、  
内部的にそのSELECT文が実行され、一時的に仮想のテーブルが作成されます。

SQLの観点から見ると、ビューはテーブルと同じものです。  
両者の違いは、テーブルには「実際のデータ」が保存されているのに対し、  
ビューには「SELECT句」が保存されている点です。

**ビューのメリット**
1. データを保存しないので、記憶装置の容量を節約できる。例: データを集約して保存するテーブルをビューに置き換える
2. 頻繁に使うSELECT文をいちいち毎回書かなくても、ビューとして保存しておくことで使いまわしが効く。

**ビューの制限**
1. ビューは基本的にどんなSELECT文でも書くことが出来るが、1つ例外がありORDER BYだけは使うことができない。
2. ビューに対する更新には、強い制限がある。

### 「ビュー」にはどんな用途やメリットがありそうでしょうか？
すでに書いてしまったので、省略

### ビューにはMaterialized Viewと呼ばれる種類があります。通常のビューと比較して、どのような差分があるのでしょうか？
Materialized View（マテリアライズドビュー）は、通常のビューとは異なり、実際のデータを保存します。  
通常のビューは仮想テーブルであり、データは保存されず、ビューを参照するたびに元のテーブルからデータを取得します。  
一方、マテリアライズドビューは、ビューの定義に基づいてデータを物理的に保存し、定期的に更新されます。

|比較項目|View|Materialized View|
|---|---|---|
|データ保持|しない|する|
|参照時の動作|SQLを実行して結果を返却|保持しているSQLの結果を返却|
|処理速度|遅い|速い|

**Materialized Viewのメリット**
1. クエリのパフォーマンスが向上する。データが物理的に保存されているため、ビューを参照する際に元のテーブルからデータを取得する必要がない。
2. 複雑なクエリの結果を事前に計算して保存できるため、計算コストが削減される。
3. 主キーやインデックスが作成できる。

**Materialized Viewのデメリット**
1. データの保存に追加の記憶装置が必要となる。
2. データの更新が必要な場合、定期的にリフレッシュする必要があるため、管理が複雑になる。


# 課題２（実装）

```sql
SELECT *
FROM employees
CROSS JOIN titles ON employees.emp_no = titles.emp_no
CROSS JOIN salaries ON employees.emp_no = salaries.emp_no
ORDER BY employees.first_name,
         titles.title,
         salaries.salary;
```

### 上記のSELECT文をVIEWとして、実行できるようにしてみましょう
```sql
CREATE VIEW SuperCrossJoinEmployees
AS 
SELECT employees.emp_no, employees.birth_date, employees.first_name, employees.last_name, employees.gender, employees.hire_date, titles.title, salaries.salary
FROM employees
CROSS JOIN titles ON employees.emp_no = titles.emp_no
CROSS JOIN salaries ON employees.emp_no = salaries.emp_no;
```
ORDER BYをViewに書くことはできない。

SELECT句で取得するときに並び替えて上げる必要がある。
```sql
SELECT *
FROM SuperCrossJoinEmployees
ORDER BY first_name, title, salary;
```


### 同じクエリの実行結果を返すビューを作成して、作成したビューからデータを取得するようにしてください。クエリのパフォーマンスはどのように変化したでしょうか？
1. Viewを使わないパターン
5回の平均: 7.8s (9s, 8s, 7s, 7s, 8s)

2. Viewを使うパターン
5回の平均: 5.6s (7s, 5s, 5s, 6s, 5s)

Viewを使うほうが早い。データベースはビューの結果をキャッシュしているおかげかな？

### 参考サイト
- [ビューの功罪](https://mickindex.sakura.ne.jp/database/db_view.html)