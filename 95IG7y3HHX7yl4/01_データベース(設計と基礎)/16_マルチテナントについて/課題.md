## マルチテナンシーとは
マルチテナントとは、SaaSやASPサービスなどのように、同一のシステムやサービスを、無関係な複数のユーザー（企業や個人）で共有するモデルを指します。同一システム内で、データベースやソフトウェア、サーバーなどを共有します。
[参考](https://www.intra-mart.jp/im-press/useful/a65)

---
## 課題1
### タイムマシンを使って過去に戻ったら、取るべき対策
- コードレビュー: 忙しくて、コードレビューが出来ていないということは、暗黙的に開発速度を上げつかわりにコードの品質を下げて、問題が発生する可能性を会社が許容しているということである。<br>
もし、PLなど決められた人がコードレビュー出来ないほど忙しい状況になったら、最悪初心者でもいいのでコードレビューすべきである。今回のようなケアレスミスは、ダブルチェックである程度防ぐことができる。
- 自動テスト: githubアクションなどで、PR作成時に自動テストが走るようにしておく。
- 開発・ステージング・本番環境の区別: 本番環境にデプロイする前に、開発やステージング環境でテストするようにする。
- 教育とドキュメンテーション: 新人エンジニアが安全にコードを書けるように、必要な教育と指導をする。
- データベースの分離: テナント毎に独立したデータベース作成する。運用コストが高くなる可能性がある。
- (将来的に)AIによるコードレビューの導入 : おそらく近いうちにGit hubなどは、AIコードレビューなどを提供するようになると思うので、それを導入するのも手段かも。もしかしたらもうあるかも。

---
## 課題2
### マルチテナントの3つのパターン
1. ### テナント毎にデータベースを分割する<br>
    メリット
    - セキュリティ: データの安全性が高い。データベースが、独立していることでテナントのデータが他のテナントに漏れるリスクを最小限に抑えることができる。
    - カスタマイズ性: それぞれのニーズに合わせてデータベースをカスタマイズすることが容易になる。

    デメリット
    - スケーラビリティと管理の複雑さ: テナントが増えるごとにデータベースも増えるため、管理が難しくなる可能性がある。また、リソースを効率的に使用するためには、各データベースのサイズやパフォーマンスを適切に管理する必要。
    - コスト: ハードウェア、ソフトウェア、管理のコストが増える。

2. ### テナント毎にスキーマを分割する
    メリット
    - カスタマイズ性: 各テナントが独自のスキーマを持つため、テナントごとにデータベーススキーマをカスタマイズすることが可能になる。
    - データの分離: 各テナントのデータはそれぞれのスキーマ内で分離されているため、テナント間でデータが混在しない。
    
    デメリット
    - 管理の複雑さ: テナントが増えるごとにスキーマも増えるため、管理が難しくなる可能性がある。
    - スケーラビリティ: テナントの数が多くなると、スキーマの数も増え、これがパフォーマンスに影響を及ぼす可能性がある。

3. ### すべてのテナントで同じスキーマを使う
    メリット
    - スケーラビリティ: すべてのテナントが同じスキーマを共有するため、新たなテナントを追加する際のオーバーヘッドが低くなる。
    - シンプルな管理: スキーマが一つだけであるため、管理や変更が容易。また、アプリケーションのコードベースもシンプルに保つことが可能。
    
    デメリット
    - データの分離: すべてのテナントが同じスキーマを共有するため、テナントのデータが他のテナントに漏れるリスクがある。
    - カスタマイズの制限: 共有スキーマでは、各テナントの特定の要件に対応するためのカスタマイズが限定的になる。
---
### RLSを活用したマルチテナントアーキテクチャの実装方法
データベースレベルでアクセス制限を行う方法
- [行レベルセキュリティ（Row-Level Security）について](https://qiita.com/masahiro-yamaguchi/items/ac4a0793b543ddcc2061)
- [Row Level Security で事故らないアプリケーションを構築する](https://blog.flinters.co.jp/entry/2022/03/28/193223#1-%E3%83%9E%E3%83%AB%E3%83%81%E3%83%86%E3%83%8A%E3%83%B3%E3%83%88%E3%81%A8%E3%81%AF)
