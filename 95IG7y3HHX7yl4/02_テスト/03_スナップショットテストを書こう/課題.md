# 課題１
> スナップショットテストとはなんでしょうか？説明してください

テスト対象のモジュールにインプットを与え、アウトプットをシリアライズした物を保存しておき、  変更前後で変化していないことを保証するテスト。  
リグレッションテストの効用がとても強い。

> スナップショットテストを用いることで、どのような不具合が防止できるでしょうか？3つほど具体的な例を挙げてみてください

1. 新人エンジニアがアプリ全体のフォントを変更してしまい、スナップショットでエラーが発生して、変更に気づくことができた。
1. ListItemの部品で修正要望があり、対応後にスナップショットテストを走らせたところ落ちた。よくよく見てみると他の画面でも共通部品として使用されており、その画面でデグレが発生していた。
1. PHP7から PHP8にversionをアップグレードし、スナップショットテストを走らせたところ落ちた。関数の引数のデフォルト値の仕様が変わった事により、Errorが発生していた。

> スナップショットテストでは防止できない不具合もあります。3つほど具体的な例を挙げてください

1. 意図的に乱数を使用して、UIを変更する画面があり、この画面のスナップショットテストを作成しようとしたができなかった。
1. アプリの機能拡充で、パフォーマンスの低下やメモリリークが発生していたがスナップショットテストではこれらの問題を感知できなかった。
1. タイマータスクで画面表示から５秒後にポップアップを表示する画面が適切に動作しているかを確認するスナップショットテストを作成しようとしたが、できなかった。

# 課題２
> ReactチュートリアルのStorybookに、スナップショットテストを追加
### ハマったポイント
`yarn add --dev @storybook/addon-storyshots`コマンドでaddon-storyshotsを追加して、テストを実行したら失敗。  
```
yarn storybook error: unknown option '-p
```
pacage versionをいじっていたら、うまくテストが走るようになった。
最終的な差分を見てみると、addon-storyshotsとstorybookのversionをあわせる必要があったっぽいです。


## テスト結果
<img src='https://github.com/YamazakiYusuke/tic-tac-toe/assets/65708113/62409f29-cd39-447b-9566-45e0df464d06' height='350'>

[実装差分](https://github.com/YamazakiYusuke/tic-tac-toe/pull/3)

> 作成されたスナップショットを見てみましょう。どんな情報が記載されているでしょうか？

HTMLのページソースが、Array型に変換されてStoryごとに保存されている。
[src/\_\_tests__/\_\_snapshots__/storybook.test.js.snap](https://github.com/YamazakiYusuke/tic-tac-toe/pull/3/files#diff-09188081616895dca821c65faa63d0831c9d9092c3176219e122a0a97dc779ea)

## 実装の変更とスナップショットテストの更新
### 実装変更後のテスト結果
ちゃんと失敗してくれてる👍   

<img height='350' alt="スクリーンショット 2023-07-26 081949" src="https://github.com/YamazakiYusuke/tic-tac-toe/assets/65708113/af8c8edb-0f3e-48e7-8402-7295b703bd39">

### >スナップショットの更新
いつも通り以下のコマンドでテストを実行
```console
> npm test storybook.test.js
```
テスト後のオプションが表示される
```console
Test Suites: 1 failed, 1 total
Tests:       6 failed, 7 passed, 13 total
Snapshots:   6 failed, 7 passed, 13 total
Time:        3.114 s
Ran all test suites matching /storybook.test.js/i.

Active Filters: filename /storybook.test.js/
 › Press c to clear filters.

Watch Usage
 › Press a to run all tests.
 › Press f to run only failed tests.
 › Press o to only run tests related to changed files.
 › Press u to update failing snapshots.
 › Press i to update failing snapshots interactively.
 › Press q to quit watch mode.
 › Press p to filter by a filename regex pattern.
 › Press t to filter by a test name regex pattern.
 › Press Enter to trigger a test run.
```
テストに失敗しているスナップショットを更新したいので、`u`を入力するとスナップショットが更新されて（テスト結果の期待値）、以降テストが成功するようになる。

# 課題３
> スナップショットテストに関連するクイズを作成してください
Q1. スナップショットを更新する際に注意することとは？
Q2. UIを変更していないのにスナップショットテストが失敗するケースはあるでしょうか？
Q3. スナップショットテストの実行処理について、初回と２回目以降の違いを教えてください。


A1. スナップショットを更新する前に、テストに失敗している箇所すべてが今回の実装変更によるものであるかを確認する。他の実装者によるデグレが混ざった状態で更新するとスナップショットテストでの発見が不可能になる為。  
実装を変更する前に、全てのテストが成功していることを確認する、あるいはCIでマージリクエストを発行する際にテストが失敗していないことを確認するのが安全。
A2. ある。iOSSnapshotTestCaseで発生している。GPUベンダーによって処理が異なるので出力画像に差異が生じ結果テストが失敗する。[メルペイiOSチームのスナップショットテストを効率化した話](https://engineering.mercari.com/blog/entry/20201220-ios-snapshot-testing/#:~:text=%E3%81%AA%E3%82%8A%E3%81%BE%E3%81%97%E3%81%9F%E3%80%82-,%E5%87%BA%E5%8A%9B%E7%94%BB%E5%83%8F%E3%81%AB%E5%BE%AE%E5%A6%99%E3%81%AB%E5%B7%AE%E3%81%8C%E3%81%82%E3%82%8B%E5%95%8F%E9%A1%8C,-%E3%83%86%E3%82%B9%E3%83%88%E6%99%82%E3%81%AB%E5%87%BA%E5%8A%9B)
A3. 初回はテストケースのアウトプット（スナップショット）を保存する。２回目以降はアウトプットと既存のスナップショットを比較していく。